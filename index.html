<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DAY & NIGHT Run for Rewards - ‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡πà‡∏á‡∏•‡πà‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #f0f9ff;
        }

        .track-bg {
            background-image: repeating-linear-gradient(90deg,
                    #e5e7eb,
                    #e5e7eb 50px,
                    #d1d5db 50px,
                    #d1d5db 100px);
            background-size: 100px 100%;
            animation: moveTrack 2s linear infinite;
            animation-play-state: paused;
        }

        .running .track-bg {
            animation-play-state: running;
        }

        @keyframes moveTrack {
            from {
                background-position: 0 0;
            }

            to {
                background-position: -100px 0;
            }
        }

        .runner-avatar {
            transition: left 0.1s linear, transform 0.2s ease;
        }

        .finish-line {
            background: repeating-linear-gradient(45deg,
                    #000,
                    #000 10px,
                    #fff 10px,
                    #fff 20px);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Keyframes for Countdown Text */
        @keyframes popIn {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }

            50% {
                transform: scale(1.2);
                opacity: 1;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .animate-pop {
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* Avatar Styling */
        .runner-img-container {
            width: 64px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .runner-custom-img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .camera-overlay {
            opacity: 0;
            transition: opacity 0.2s;
        }

        .runner-img-container:hover .camera-overlay {
            opacity: 1;
        }
    </style>
</head>

<body class="h-screen flex flex-col md:flex-row overflow-hidden">

    <!-- Sidebar: Setup Panel -->
    <div class="w-full md:w-1/4 bg-white shadow-xl z-20 flex flex-col p-6 border-r border-gray-200">

        <!-- Logo Section -->
        <div class="flex flex-col items-center mb-6 text-center">
            <img src="/imgs/3b473a2e-87a4-43a0-b91e-1fd5c1b95b09.png" alt="Logo"
                class="w-24 h-24 mb-3 rounded-full shadow-lg border-4 border-white bg-blue-50 object-cover transform hover:rotate-6 transition-transform duration-300">

            <h1 class="text-2xl font-bold text-blue-600 tracking-tight">
                DAY & NIGHT Run for Rewards
            </h1>
            <p class="text-gray-500 text-sm">‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡πà‡∏á‡∏•‡πà‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</p>
        </div>

        <div class="flex-1 flex flex-col gap-4">
            <div>
                <label class="block text-gray-700 font-medium mb-2">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡πà‡∏á (‡∏Ñ‡∏ô‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)</label>
                <textarea id="nameInput"
                    class="w-full h-40 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none resize-none text-sm"
                    placeholder="‡∏™‡∏°‡∏ä‡∏≤‡∏¢&#10;‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á&#10;John&#10;Alice"></textarea>
                <div class="text-right text-xs text-gray-400 mt-1" id="countDisplay">0 ‡∏Ñ‡∏ô</div>
            </div>

            <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                <h3 class="font-semibold text-blue-800 mb-2 text-sm">‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤ & ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ</h3>
                <ul class="text-xs text-blue-600 list-disc list-inside space-y-1">
                    <li>‡∏Å‡∏î <b>"‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°"</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡πà‡∏ß‡∏¥‡πà‡∏á</li>
                    <li><b>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£</b> ‡πÉ‡∏ô‡∏™‡∏ô‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</li>
                    <li>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏≥‡πÑ‡∏ß‡πâ‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠</li>
                </ul>
            </div>
        </div>

        <div class="mt-6 flex flex-col gap-3">
            <button onclick="setupRace()"
                class="w-full bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-3 rounded-lg transition shadow-sm">
                ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏° (Reset)
            </button>
            <button onclick="prepareRace()" id="startBtn"
                class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-3 rounded-lg shadow-lg transform transition active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed"
                disabled>
                üî´ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô!
            </button>
        </div>
    </div>

    <!-- Main: Race Track -->
    <div class="flex-1 relative bg-gray-100 flex flex-col overflow-hidden">
        <!-- Stadium Header -->
        <div
            class="bg-gray-800 text-white p-2 text-center text-xs tracking-wider shadow-md z-10 flex justify-between px-4 items-center">
            <span>DAY AND NIGHT STADIUM 2025-28 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2568</span>
            <span id="statusBadge"
                class="hidden bg-red-600 text-white text-[10px] px-2 py-0.5 rounded animate-pulse">SLOW MOTION</span>
        </div>

        <!-- Tracks Container -->
        <div id="trackContainer" class="flex-1 overflow-y-auto overflow-x-hidden relative p-4 pb-20 scroll-smooth">
            <div class="flex h-full items-center justify-center text-gray-400">
                <div class="text-center">
                    <div class="text-6xl mb-4">üèüÔ∏è</div>
                    <p>‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°"</p>
                </div>
            </div>
        </div>

        <!-- Finish Line Marker (Visual Overlay) -->
        <div class="absolute top-0 bottom-0 right-8 w-4 finish-line opacity-50 pointer-events-none z-0 hidden"
            id="finishLineParams"></div>
    </div>

    <!-- Countdown Overlay -->
    <div id="countdownOverlay"
        class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden backdrop-blur-sm">
        <div id="countdownText"
            class="text-9xl font-black text-yellow-400 drop-shadow-[0_10px_10px_rgba(0,0,0,0.5)] tracking-tighter animate-pop">
            3
        </div>
    </div>

    <!-- Winner Modal -->
    <div id="winnerModal"
        class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-8 max-w-sm w-full text-center shadow-2xl transform scale-90 opacity-0 transition-all duration-300 flex flex-col items-center"
            id="winnerCard">
            <!-- Winner Image Display -->
            <div id="winnerImageContainer" class="mb-4 hidden">
                <img id="winnerImage" src=""
                    class="w-24 h-24 rounded-full border-4 border-yellow-400 shadow-lg object-cover">
            </div>
            <div id="winnerEmoji" class="text-6xl mb-4 animate-bounce">üèÜ</div>

            <h2 class="text-2xl font-bold text-gray-800 mb-2">‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏Ñ‡∏∑‡∏≠!</h2>
            <div id="winnerName"
                class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-500 to-red-500 py-2">
                -
            </div>
            <p class="text-gray-500 mt-2 text-sm">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö!</p>

            <div class="mt-6 flex flex-col gap-3 w-full">
                <button onclick="removeWinner()"
                    class="w-full bg-red-100 hover:bg-red-200 text-red-700 font-bold py-3 px-4 rounded-xl transition border border-red-200 flex items-center justify-center gap-2">
                    <span>‚ùå</span> ‡∏•‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏≠‡∏≠‡∏Å
                </button>
                <button onclick="closeModal()"
                    class="w-full bg-gray-900 text-white font-bold py-3 px-4 rounded-xl hover:bg-gray-800 transition shadow-lg flex items-center justify-center gap-2">
                    <span>üîÑ</span> ‡πÄ‡∏•‡πà‡∏ô‡∏£‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡πÑ‡∏õ (‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ß‡πâ)
                </button>
            </div>
        </div>
    </div>

    <!-- Hidden File Input -->
    <input type="file" id="avatarInput" class="hidden" accept="image/*">

    <!-- Canvas for Confetti -->
    <canvas id="confettiCanvas" class="fixed inset-0 pointer-events-none z-50"></canvas>

    <script>
        // --- Game State ---
        let runners = [];
        let isRacing = false;
        let animationFrameId;
        let lastWinnerName = "";
        let imageMap = {}; // Store images mapped by name
        let editingRunnerIndex = -1; // Which runner is being edited

        const emojis = ['üèÉ', 'üèÉ‚Äç‚ôÇÔ∏è', 'üèÉ‚Äç‚ôÄÔ∏è', 'ü¶∏‚Äç‚ôÇÔ∏è', 'ü¶∏‚Äç‚ôÄÔ∏è', 'ü•∑', 'üßü', 'ü§ñ'];
        const colors = ['bg-red-500', 'bg-blue-500', 'bg-green-500', 'bg-yellow-500', 'bg-purple-500', 'bg-pink-500', 'bg-indigo-500', 'bg-teal-500'];

        // --- DOM Elements ---
        const trackContainer = document.getElementById('trackContainer');
        const nameInput = document.getElementById('nameInput');
        const startBtn = document.getElementById('startBtn');
        const finishLineParams = document.getElementById('finishLineParams');
        const countDisplay = document.getElementById('countDisplay');
        const countdownOverlay = document.getElementById('countdownOverlay');
        const countdownText = document.getElementById('countdownText');
        const statusBadge = document.getElementById('statusBadge');
        const avatarInput = document.getElementById('avatarInput');

        // --- Event Listeners ---
        nameInput.addEventListener('input', () => {
            const lines = nameInput.value.split('\n').filter(line => line.trim() !== '');
            countDisplay.innerText = `${lines.length} ‡∏Ñ‡∏ô`;
        });

        avatarInput.addEventListener('change', function (e) {
            if (this.files && this.files[0] && editingRunnerIndex !== -1) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const base64 = e.target.result;

                    // Update Runner Data
                    runners[editingRunnerIndex].customImage = base64;

                    // Update Image Map (Persistent by name)
                    imageMap[runners[editingRunnerIndex].name] = base64;

                    // Update DOM
                    updateRunnerAvatar(editingRunnerIndex, base64);
                }
                reader.readAsDataURL(this.files[0]);
            }
            // Reset input so same file can be selected again
            this.value = '';
        });

        // --- Core Functions ---

        function setupRace() {
            // Reset State
            cancelAnimationFrame(animationFrameId);
            isRacing = false;
            startBtn.disabled = false;
            startBtn.innerHTML = "üî´ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô!";
            startBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
            statusBadge.classList.add('hidden');

            // Parse Names
            const names = nameInput.value.split('\n').filter(line => line.trim() !== '');

            if (names.length < 2) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏Ñ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
                return;
            }

            // Clear Track
            trackContainer.innerHTML = '';
            trackContainer.classList.remove('track-bg');
            finishLineParams.classList.remove('hidden');

            // Generate Runners
            runners = names.map((name, index) => {
                const avatarEmoji = emojis[index % emojis.length];
                // Check if we have a saved image for this name
                const savedImage = imageMap[name] || null;

                // Create Lane HTML
                const lane = document.createElement('div');
                lane.className = "relative h-20 border-b border-gray-300 flex items-center w-full bg-white bg-opacity-80 mb-1 rounded-l-md shadow-sm";

                // Track Number
                const number = document.createElement('div');
                number.className = "w-8 text-center text-xs font-bold text-gray-400 flex-shrink-0";
                number.innerText = index + 1;

                // Runner Element Container
                const runnerEl = document.createElement('div');
                runnerEl.className = "absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-1/2 flex flex-col items-center transition-all z-10";
                runnerEl.style.left = '50px';

                // Avatar Visuals
                const avatarContainer = document.createElement('div');
                avatarContainer.className = "runner-img-container cursor-pointer group";
                avatarContainer.onclick = () => triggerUpload(index);

                // Overlay for hover
                const overlay = document.createElement('div');
                overlay.className = "camera-overlay absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center text-white text-xl font-bold z-20 pointer-events-none";
                overlay.innerHTML = "üì∑";

                // Content (Image or Emoji)
                const content = document.createElement('div');
                content.id = `runner-visual-${index}`;
                content.className = "w-full h-full flex items-center justify-center text-4xl filter drop-shadow-md";

                if (savedImage) {
                    content.innerHTML = `<img src="${savedImage}" class="runner-custom-img">`;
                } else {
                    content.innerText = avatarEmoji;
                }

                avatarContainer.appendChild(content);
                avatarContainer.appendChild(overlay);

                // Name Tag
                const nameTag = document.createElement('div');
                nameTag.className = "text-[10px] font-bold bg-gray-800 text-white px-2 rounded-full whitespace-nowrap z-10 -mt-2 shadow border border-white";
                nameTag.innerText = name;

                runnerEl.appendChild(avatarContainer);
                runnerEl.appendChild(nameTag);

                // Finish Line Flag inside lane
                const finishFlag = document.createElement('div');
                finishFlag.className = "absolute right-8 top-0 bottom-0 w-1 bg-red-200 opacity-50";

                lane.appendChild(number);
                lane.appendChild(finishFlag);
                lane.appendChild(runnerEl);
                trackContainer.appendChild(lane);

                return {
                    id: index,
                    name: name,
                    element: runnerEl,
                    visualId: `runner-visual-${index}`,
                    customImage: savedImage,
                    emoji: avatarEmoji,
                    position: 0,
                    speed: 0,
                    finished: false,
                    laneWidth: 0
                };
            });
        }

        function triggerUpload(index) {
            if (isRacing) return; // Prevent changing during race
            editingRunnerIndex = index;
            avatarInput.click();
        }

        function updateRunnerAvatar(index, imageUrl) {
            const container = document.getElementById(`runner-visual-${index}`);
            if (container) {
                container.innerHTML = `<img src="${imageUrl}" class="runner-custom-img">`;
            }
        }

        function prepareRace() {
            if (isRacing) return;
            if (runners.length === 0) {
                setupRace();
                if (runners.length === 0) return;
            }

            // Start Countdown sequence
            startBtn.disabled = true;
            countdownOverlay.classList.remove('hidden');

            let count = 3;
            countdownText.innerText = count;

            countdownText.classList.remove('animate-pop');
            void countdownText.offsetWidth;
            countdownText.classList.add('animate-pop');

            const timer = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownText.innerText = count;
                    countdownText.classList.remove('animate-pop');
                    void countdownText.offsetWidth;
                    countdownText.classList.add('animate-pop');
                } else if (count === 0) {
                    countdownText.innerText = "GO!";
                    countdownText.classList.remove('animate-pop');
                    void countdownText.offsetWidth;
                    countdownText.classList.add('animate-pop');
                } else {
                    clearInterval(timer);
                    countdownOverlay.classList.add('hidden');
                    startRaceEngine();
                }
            }, 1000);
        }

        function startRaceEngine() {
            isRacing = true;
            startBtn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô...";

            const containerWidth = trackContainer.clientWidth;
            const finishLineOffset = 40;
            const startOffset = 50;

            runners.forEach(r => {
                r.laneWidth = containerWidth - startOffset - finishLineOffset;
                r.position = 0;
                r.speed = Math.random() * 0.3 + 0.1;
                r.finished = false;
            });

            lastTime = performance.now();
            requestAnimationFrame(gameLoop);
        }

        let lastTime = 0;

        function gameLoop(timestamp) {
            if (!isRacing) return;

            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;

            let someoneFinished = false;
            let winner = null;

            let maxPos = 0;
            runners.forEach(r => {
                if (r.position > maxPos) maxPos = r.position;
            });

            let timeScale = 1.0;
            if (maxPos > 85) {
                timeScale = 0.3;
                statusBadge.classList.remove('hidden');
            } else {
                statusBadge.classList.add('hidden');
            }

            runners.forEach(runner => {
                if (runner.finished) return;

                const variation = (Math.random() - 0.5) * 0.1;
                runner.speed += variation;

                if (runner.speed < 0.1) runner.speed = 0.1;
                if (runner.speed > 0.8) runner.speed = 0.8;

                if (Math.random() < 0.008) {
                    runner.speed += 0.5;
                }

                if (Math.random() < 0.005) {
                    runner.speed = 0.05;
                }

                const movement = runner.speed * (deltaTime / 16) * timeScale;
                runner.position += movement;

                const pixelPos = 50 + (runner.position / 100 * runner.laneWidth);
                runner.element.style.left = `${pixelPos}px`;

                const scale = 1 + (runner.speed / 4);
                runner.element.querySelector('.runner-img-container').style.transform = `scale(${scale})`;
                runner.element.style.zIndex = Math.floor(runner.position);

                if (runner.position >= 100) {
                    runner.finished = true;
                    runner.element.style.left = `${50 + runner.laneWidth}px`;
                    if (!someoneFinished) {
                        someoneFinished = true;
                        winner = runner;
                    }
                }
            });

            if (someoneFinished) {
                setTimeout(() => {
                    endGame(winner);
                }, 500);
            } else {
                animationFrameId = requestAnimationFrame(gameLoop);
            }
        }

        function endGame(winner) {
            isRacing = false;
            startBtn.innerText = "‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏à‡∏ö‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß";
            statusBadge.classList.add('hidden');
            lastWinnerName = winner.name;

            const modal = document.getElementById('winnerModal');
            const card = document.getElementById('winnerCard');
            const winnerNameEl = document.getElementById('winnerName');
            const winnerImgContainer = document.getElementById('winnerImageContainer');
            const winnerImg = document.getElementById('winnerImage');
            const winnerEmoji = document.getElementById('winnerEmoji');

            winnerNameEl.innerText = winner.name;

            // Show Image or Emoji in Modal
            if (winner.customImage) {
                winnerImg.src = winner.customImage;
                winnerImgContainer.classList.remove('hidden');
                winnerEmoji.classList.add('hidden');
            } else {
                winnerImgContainer.classList.add('hidden');
                winnerEmoji.classList.remove('hidden');
                winnerEmoji.innerText = winner.emoji; // Use their specific emoji
            }

            modal.classList.remove('hidden');

            setTimeout(() => {
                card.classList.remove('scale-90', 'opacity-0');
                card.classList.add('scale-100', 'opacity-100');
            }, 10);

            fireConfetti();
        }

        function removeWinner() {
            const currentNames = nameInput.value.split('\n');
            const index = currentNames.findIndex(name => name.trim() === lastWinnerName);

            if (index !== -1) {
                // Optionally remove image from map if you want to save memory, 
                // but keeping it is better if they add the name back later.
                // delete imageMap[lastWinnerName]; 

                currentNames.splice(index, 1);
                nameInput.value = currentNames.join('\n');
                nameInput.dispatchEvent(new Event('input'));
            }

            closeModal();
        }

        function closeModal() {
            const modal = document.getElementById('winnerModal');
            const card = document.getElementById('winnerCard');

            card.classList.remove('scale-100', 'opacity-100');
            card.classList.add('scale-90', 'opacity-0');

            setTimeout(() => {
                modal.classList.add('hidden');
                setupRace();
            }, 300);
        }

        // --- Simple Confetti Logic (Canvas) ---
        const canvas = document.getElementById('confettiCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function fireConfetti() {
            particles = [];
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#00ffff', '#ff00ff'];

            for (let i = 0; i < 300; i++) {
                particles.push({
                    x: window.innerWidth / 2,
                    y: window.innerHeight / 2,
                    vx: (Math.random() - 0.5) * 20,
                    vy: (Math.random() - 0.5) * 20 - 5,
                    life: Math.random() * 100 + 50,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 5 + 2
                });
            }
            updateConfetti();
        }

        function updateConfetti() {
            if (particles.length === 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                return;
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let i = 0; i < particles.length; i++) {
                let p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.2;
                p.life--;

                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();

                if (p.life <= 0) {
                    particles.splice(i, 1);
                    i--;
                }
            }

            requestAnimationFrame(updateConfetti);
        }

        nameInput.value = "‡∏û‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏µ‡∏¢‡∏ß\n‡∏û‡∏µ‡πà‡πÅ‡∏°‡∏ß\n‡∏û‡∏µ‡πà‡πÄ‡∏≠‡πá‡∏°\n‡∏û‡∏µ‡πà‡πÄ‡∏≠‡πá‡∏°\n‡∏û‡∏µ‡πà‡∏≠‡πâ‡∏ô\n‡∏û‡∏µ‡πà‡πÇ‡∏≠‡πÄ‡∏•‡πà";
        nameInput.dispatchEvent(new Event('input'));
    </script>
</body>

</html>